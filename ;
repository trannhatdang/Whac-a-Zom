import pygame
import time
import os
import random
import cevent
from pygame.locals import *

ZOMBIE_IMG_PATH = os.path.join('data', 'zombie.png')
BACKGROUND_IMG_PATH = os.path.join('data', 'background.png')
SPAWN_TIME = 1
SPAWN_LOCATIONS = [(100, 100), (100, 50)]

'''
class SpawnLocation:
    def __init__(self, position):
        self._position = position
        self.is_occupied = False
'''

class Zombie:
    def __init__(self, position):
        self.sprite = ZOMBIE_PNG_PATH
        self.is_alive = True
        self.should_be_destroyed = False
        self.anim_frame = -1
        self.box_collider = (10, 10)
        self._position = position
        self._alive_time = 1
        pass

    def on_loop(self, frametime):
        if self.anim_frame >= 0:
            if self.anim_frame < 8:
                self._change_sprite(self.anim_frame)
                self.anim_frame = self.anim_frame + 1
            else:
                self.should_be_destroyed(True)

        self._alive_time = self._alive_time - frametime
        if self._alive_time <= 0:
            self.playing_anim = 0
            self.is_alive = False

    def _change_sprite(self, ind):
        pass
 
class App(cevent.CEvent):
    def __init__(self):
        self._display_surf = None
        self._alive_zombies = []

        self._free_spawn_locations = self.create_spawn_locations()
        self._occupied_spawn_locations = []

        self._spawn_timer = SPAWN_TIME
        self._frametime = 0
        random.seed(time.time())

        self.size = self.weight, self.height = 1280, 720

    def create_spawn_locations(self):
        retval = []
        for i in range(3):
            for j in range(3):
                retval.append((300 + i * 100, 100 + j * 100))
        
        return retval

    def get_random_spawn_location(self):
        return self._spawn_locations[random.randrange(0, len(self._spawn_locations))]
 
    def on_init(self):
        pygame.init()
        self._display_surf = pygame.display.set_mode(self.size, pygame.HWSURFACE | pygame.DOUBLEBUF)
        self._running = True
 
    def on_loop(self):
        for zombie in self._alive_zombies:
            zombie.on_loop(self._frametime)

            if zombie.should_be_destroyed:
                self._alive_zombies.remove(zombie)

        self._spawn_timer = self._spawn_timer - self._frametime
        if self._spawn_timer <= 0:
            self._alive_zombies.append(Zombie(self.get_random_spawn_location()))

    def on_render(self):
        for zombie in self._alive_zombies:
            self._display_surf.blit(zombie.SPRITE, zombie.position)

    def on_cleanup(self):
        pygame.quit()
 
    def on_execute(self):
        if self.on_init() == False:
            self._running = False
 
        while( self._running ):
            start_time = time.time()

            for event in pygame.event.get():
                self.on_event(event)
            self.on_loop()
            self.on_render()

            self._frametime = time.time() - start_time
        self.on_cleanup()
 
if __name__ == "__main__" :
    game = App()
    game.on_execute()
